@include('emails.partials.header')<!-- Body starts --><!--[if mso | IE]><tr><td width=600px><table border=0 cellpadding=0 cellspacing=0 align=center style=width:580px width=580><tr><td style=line-height:0;font-size:0;mso-line-height-rule:exactly><![endif]--><div style="background:#fff;background-color:#fff;Margin:0 auto;max-width:580px"><table border=0 cellpadding=0 cellspacing=0 role=presentation style=background:#fff;background-color:#fff;width:100% align=center><tr><td style="direction:ltr;font-size:0;padding:20px 0;text-align:center;vertical-align:top"><!--[if mso | IE]><table border=0 cellpadding=0 cellspacing=0 role=presentation><tr><td style=vertical-align:top;width:580px><![endif]--><div style=font-size:13px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100% class="mj-column-per-100 outlook-group-fix"><table border=0 cellpadding=0 cellspacing=0 role=presentation style=vertical-align:top width=100%><tr><td style="font-size:0;padding:10px 25px;word-break:break-word"align=left><div style="font-family:Roboto,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-size:18px;line-height:30px;text-align:left;color:#333">Dear {{$team->consumer->user->first_name}},</div><tr><td style="font-size:0;padding:10px 25px;word-break:break-word"align=left><div style="font-family:Roboto,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-size:18px;line-height:30px;text-align:left;color:#333">On {{ carbon_format_to_datetime_for_fixture_mail($data['currentDateTime']) }} the following Supersubs were set for '{{ $team->name }}'</div></tr>@foreach($data['fixtures'] as $key => $value)<tr><td style="font-size:0;padding:10px 25px;word-break:break-word"align=left class="font-mono light-text"><div style="font-family:Roboto,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-size:18px;line-height:30px;text-align:left;color:#333"><b>{{ carbon_format_to_datetime_for_fixture_mail($key) }}</b> @foreach($value['activePlayers'] as $pos => $players) @foreach($players as $player) @php $teamLineupRepository = app(\App\Repositories\TeamLineupRepository::class); $nextFixture = $teamLineupRepository->getNextFixtureDataAfterDate($player, '', '', \Carbon\Carbon::parse($key, config('fantasy.time.timezone'))->tz('UTC')->toDateTimeString()); @endphp<div>@if(isset($nextFixture['PL']) && isset($nextFixture['PL']['date_time']) && $key == carbon_format_to_datetime_for_fixture($nextFixture['PL']['date_time'])) <b>{{ get_player_name('firstNameFirstCharAndFullLastName', $player['player_first_name'], $player['player_last_name']) }} ({{ $player['short_code'] }}) v {{ $nextFixture['PL']['short_code'] }} ({{ strtolower($nextFixture['PL']['type']) }})</b> @elseif(isset($nextFixture['FA']) && isset($nextFixture['FA']['date_time']) && $key == carbon_format_to_datetime_for_fixture($nextFixture['FA']['date_time'])) <b>{{ get_player_name('firstNameFirstCharAndFullLastName', $player['player_first_name'], $player['player_last_name']) }} ({{ $player['short_code'] }}) v {{ $nextFixture['FA']['short_code'] }} ({{ strtolower($nextFixture['FA']['type']) }})</b> @elseif(isset($nextFixture['date_time']) && $key == carbon_format_to_datetime_for_fixture($nextFixture['date_time'])) <b>{{ get_player_name('firstNameFirstCharAndFullLastName', $player['player_first_name'], $player['player_last_name']) }} ({{ $player['short_code'] }}) v {{ $nextFixture['short_code'] }} ({{ strtolower($nextFixture['type']) }})</b> @else {{ get_player_name('firstNameFirstCharAndFullLastName', $player['player_first_name'], $player['player_last_name']) }} ({{ $player['short_code'] }}) @endif</div>@endforeach() @endforeach() @if($value['subPlayers'])<div style="font-family:Roboto,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-size:18px;line-height:30px;text-align:left;color:#333"><div style=padding-top:10px><b>Substitutes:</b> @php $sortedSubs = collect($value['subPlayers'])->sortBy(function($sub) { return array_search(is_array($sub) ? $sub['position'] : $sub->position, ['GK', 'FB', 'CB', 'DF', 'DMF', 'MF', 'ST']); }) @endphp</div>@foreach($sortedSubs as $player) @php $teamLineupRepository = app(\App\Repositories\TeamLineupRepository::class); $nextFixture = $teamLineupRepository->getNextFixtureDataAfterDate($player, '', '', \Carbon\Carbon::parse($key, config('fantasy.time.timezone'))->tz('UTC')->toDateTimeString()); @endphp<div>@if(isset($nextFixture['PL']) && isset($nextFixture['PL']['date_time']) && $key == carbon_format_to_datetime_for_fixture($nextFixture['PL']['date_time'])) <b>{{ get_player_name('firstNameFirstCharAndFullLastName', $player['player_first_name'], $player['player_last_name']) }} ({{ $player['short_code'] }}) v {{ $nextFixture['PL']['short_code'] }} ({{ strtolower($nextFixture['PL']['type']) }}) {{ carbon_format_to_datetime_for_fixture_mail(carbon_format_to_datetime_for_fixture($nextFixture['PL']['date_time'])) }}</b> @elseif(isset($nextFixture['FA']) && isset($nextFixture['FA']['date_time']) && $key == carbon_format_to_datetime_for_fixture($nextFixture['FA']['date_time'])) <b>{{ get_player_name('firstNameFirstCharAndFullLastName', $player['player_first_name'], $player['player_last_name']) }} ({{ $player['short_code'] }}) v {{ $nextFixture['FA']['short_code'] }} ({{ strtolower($nextFixture['FA']['type']) }})</b> @elseif(isset($nextFixture['date_time']) && $key == carbon_format_to_datetime_for_fixture($nextFixture['date_time'])) <b>{{ get_player_name('firstNameFirstCharAndFullLastName', $player['player_first_name'], $player['player_last_name']) }} ({{ $player['short_code'] }}) v {{ $nextFixture['short_code'] }} ({{ strtolower($nextFixture['type']) }})</b> @else {{ get_player_name('firstNameFirstCharAndFullLastName', $player['player_first_name'], $player['player_last_name']) }} ({{ $player['short_code'] }}) @endif</div>@endforeach()</div>@endif</div></tr>@endforeach()</table></div><!--[if mso | IE]><![endif]--></table></div><!--[if mso | IE]><tr><td width=600px><table border=0 cellpadding=0 cellspacing=0 align=center style=width:580px width=580><tr><td style=line-height:0;font-size:0;mso-line-height-rule:exactly><![endif]--><div style="background:#fff;background-color:#fff;Margin:0 auto;max-width:580px"><table border=0 cellpadding=0 cellspacing=0 role=presentation style=background:#fff;background-color:#fff;width:100% align=center><tr><td style="direction:ltr;font-size:0;padding:20px 0;text-align:center;vertical-align:top"><!--[if mso | IE]><table border=0 cellpadding=0 cellspacing=0 role=presentation><tr><td style=vertical-align:top;width:580px><![endif]--><div style=font-size:13px;text-align:left;direction:ltr;display:inline-block;vertical-align:top;width:100% class="mj-column-per-100 outlook-group-fix"><table border=0 cellpadding=0 cellspacing=0 role=presentation style=vertical-align:top width=100%><tr><td style="font-size:0;padding:10px 25px;word-break:break-word"align=left><div style="font-family:Roboto,-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Helvetica Neue',Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji','Segoe UI Symbol';font-size:18px;line-height:30px;text-align:left;color:#333">Regards,<br>The Fantasy League team</div></table></div><!--[if mso | IE]><![endif]--></table></div><!--[if mso | IE]><![endif]--><!-- Body ends --> @include('emails.partials.footer')
